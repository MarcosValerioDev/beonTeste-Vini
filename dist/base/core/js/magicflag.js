(()=>{"use strict";var e=function(e,n){if(this.root=e,window.beonevents&&window.beonevents[n.id])return;const[t,i,o,a,s,r,d,c,l,m,p,u]=n;return this.config=Object.assign({id:void 0,type:"flag",variant:"seal",position:"45deg",className:void 0,innerHTML:void 0,sealSrc:void 0,style:void 0,itemQuery:void 0,containerQuery:"self",placementOperation:"append",itemsIds:[]},{id:t,type:i,variant:o,position:a,className:s,innerHTML:r,sealSrc:d,style:c,itemQuery:l,containerQuery:m,placementOperation:p,itemsIds:u}),this.init(),this};e.prototype.init=function(){var e;this.root.className=this.root.className+" initialized",this.add(this.config).then((e=>{window.beonevents&&window.beonevents[this.config.id]||(window.beonevents=window.beonevents||{},window.beonevents[this.config.id]=!0)})),document.addEventListener("beon.buddy.slider.init.after",(n=>{window.clearTimeout(e),e=window.setTimeout((()=>{console.log("flags add after slider initialize"),this.add(this.config,document)}),500)})),window.addEventListener("hashchange",(n=>{window.clearTimeout(e),e=window.setTimeout((()=>{console.log("flags add after window change"),this.add(this.config,document)}),1e3)}))},e.prototype.add=function(e,n){return new Promise(function(t){let i;n=n||document,"bullet"===e.variant&&(i=e.innerHTML);for(var o=[],a=0;a<e.itemsIds.length;a++)o.push(new Promise((t=>{var o=e.itemsIds[a];let s,r;Array.isArray(o)?[s,...r]=o:s=o;var d=e.itemQuery.replace(/{id}/gi,s),c=n.querySelectorAll(d);if(c.length){if("dynamic"===e.type){const[n,t]=r;n&&(e.innerHTML=i?i.replace("{x}",` <span class="dynamic_info">${n}</span> `):n),e.className+=t||""}c.length&&c.forEach((n=>{var t="self"===e.containerQuery?n:n.querySelector(e.containerQuery);t||(t=n),this.append(t,e)})),t()}else t()})));Promise.all(o).then((e=>t(e)))}.bind(this))},e.prototype.append=function(e,n){if(!e.querySelector(".beon-tags.beon-tag__"+n.id)){var t=document.createElement("div"),i=["beon-tags","beon-tag__"+n.id,"beon-tag__"+n.position,"beon-tag__"+n.type,"beon-tag__"+n.type+"--"+n.variant,n.className],o=n.style;n.sealSrc&&(o+="background-image: url("+n.sealSrc+");"),t.className=i.join(" "),t.setAttribute("style",o),t.innerHTML=n.innerHTML,"replace"===n.placementOperation&&(e.innerHTML=""),e.appendChild(t)}};const n=e;var t=function(){this.componentRootSelector="meta[name^=beon-magicflag]",this.initComponents(),this.bindEvents()};t.prototype.bindEvents=function(){document.addEventListener("DOMContentLoaded",this.initComponents.bind(this)),document.addEventListener("beon.buddy.elements.handle.item.inject.success",this.initComponentFromInjection.bind(this)),document.addEventListener("beon.buddy.inject.after",this.initComponentFromInjection.bind(this)),this.initComponents()},t.prototype.initComponents=function(){var e=document.querySelectorAll(this.componentRootSelector+":not(.initialized)");Array.prototype.slice.call(e).forEach(function(e){this.initComponent(e)}.bind(this))},t.prototype.initComponentFromInjection=function(e){var n=e.detail.container.querySelector(this.componentRootSelector+":not(.initialized)");n&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){this.initComponent(n)}.bind(this)):this.initComponent(n))},t.prototype.initComponent=function(e){try{window.beon_init_log=window.beon_init_log||[];var t=e.getAttribute("data-config"),i=e.parentNode.id,o=JSON.parse(t);if(window.beon_init_log.indexOf(i)>-1)return;window.beon_init_log.push(i),new Promise((function(t,i){t(new n(e,o))}))}catch(e){console.log("failed to build component "+this.componentRootSelector,e)}},window&&(window.BeonMagicFlagInitializer=t)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ibi50ZW5hbnQuY3VzdG9tLmJhc2UvLi9zcmMvYmFzZS9zcmMvanMvbWFnaWNmbGFnL21hZ2ljZmxhZy5qcyIsIndlYnBhY2s6Ly9ibi50ZW5hbnQuY3VzdG9tLmJhc2UvLi9zcmMvYmFzZS9zcmMvanMvbWFnaWNmbGFnL2luaXQuanMiXSwibmFtZXMiOlsiTWFnaWNGbGFnQ29tcG9uZW50Iiwicm9vdCIsImNvbmZpZyIsInRoaXMiLCJ3aW5kb3ciLCJiZW9uZXZlbnRzIiwiaWQiLCJ0eXBlIiwidmFyaWFudCIsInBvc2l0aW9uIiwiY2xhc3NOYW1lIiwiaW5uZXJIVE1MIiwic2VhbFNyYyIsInN0eWxlIiwiaXRlbVF1ZXJ5IiwiY29udGFpbmVyUXVlcnkiLCJwbGFjZW1lbnRPcGVyYXRpb24iLCJpdGVtc0lkcyIsIk9iamVjdCIsImFzc2lnbiIsInVuZGVmaW5lZCIsImluaXQiLCJwcm90b3R5cGUiLCJkZWJvdW5jZSIsImFkZCIsInRoZW4iLCJyZXMiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJjb25zb2xlIiwibG9nIiwib3B0aW9ucyIsImNvbnRhaW5lciIsIlByb21pc2UiLCJyZXNvbHZlIiwiY29udGVudFRlbXBsYXRlIiwicHJvbWlzZXNBcnJheSIsImkiLCJsZW5ndGgiLCJwdXNoIiwiaXRlbURlZmluaXRpb24iLCJpdGVtSWQiLCJhcmdzIiwiQXJyYXkiLCJpc0FycmF5IiwiZWxlbWVudHNTZWxlY3RvciIsInJlcGxhY2UiLCJlbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpdGVtSW5uZXJIdG1sIiwiaXRlbUNsYXNzTmFtZSIsImZvckVhY2giLCJlbGVtZW50IiwicGFyZW50IiwicXVlcnlTZWxlY3RvciIsImFwcGVuZCIsImFsbCIsImJpbmQiLCJidWxsZXQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NlcyIsImpvaW4iLCJzZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsIk1hZ2ljRmxhZ0luaXRpYWxpemVyIiwiY29tcG9uZW50Um9vdFNlbGVjdG9yIiwiaW5pdENvbXBvbmVudHMiLCJiaW5kRXZlbnRzIiwiaW5pdENvbXBvbmVudEZyb21JbmplY3Rpb24iLCJjb21wb25lbnRzIiwic2xpY2UiLCJjYWxsIiwiaW5pdENvbXBvbmVudCIsImRldGFpbCIsInJlYWR5U3RhdGUiLCJiZW9uX2luaXRfbG9nIiwicmF3Q29uZmlnIiwiZ2V0QXR0cmlidXRlIiwicm9vdElkIiwicGFyZW50Tm9kZSIsIkpTT04iLCJwYXJzZSIsImluZGV4T2YiLCJyZWplY3QiLCJlIiwiQmVvbk1hZ2ljRmxhZ0luaXRpYWxpemVyIl0sIm1hcHBpbmdzIjoibUJBQUEsSUFBSUEsRUFBcUIsU0FBVUMsRUFBTUMsR0FHdkMsR0FGQUMsS0FBS0YsS0FBT0EsRUFFUkcsT0FBT0MsWUFBY0QsT0FBT0MsV0FBV0gsRUFBT0ksSUFDaEQsT0FHRixNQUNFQSxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxHQUNFZixFQW1DSixPQWpDQUMsS0FBS0QsT0FBU2dCLE9BQU9DLE9BQ25CLENBQ0ViLFFBQUljLEVBQ0piLEtBQU0sT0FDTkMsUUFBUyxPQUNUQyxTQUFVLFFBQ1ZDLGVBQVdVLEVBQ1hULGVBQVdTLEVBQ1hSLGFBQVNRLEVBQ1RQLFdBQU9PLEVBQ1BOLGVBQVdNLEVBQ1hMLGVBQWdCLE9BQ2hCQyxtQkFBb0IsU0FDcEJDLFNBQVUsSUFFWixDQUNFWCxLQUNBQyxPQUNBQyxVQUNBQyxXQUNBQyxZQUNBQyxZQUNBQyxVQUNBQyxRQUNBQyxZQUNBQyxpQkFDQUMscUJBQ0FDLGFBSUpkLEtBQUtrQixPQUVFbEIsTUFHVEgsRUFBbUJzQixVQUFVRCxLQUFPLFdBYWxDLElBQUlFLEVBWkpwQixLQUFLRixLQUFLUyxVQUFZUCxLQUFLRixLQUFLUyxVQUFZLGVBRzVDUCxLQUFLcUIsSUFBSXJCLEtBQUtELFFB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ZmxhZy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBNYWdpY0ZsYWdDb21wb25lbnQgPSBmdW5jdGlvbiAocm9vdCwgY29uZmlnKSB7XG4gIHRoaXMucm9vdCA9IHJvb3Q7XG5cbiAgaWYgKHdpbmRvdy5iZW9uZXZlbnRzICYmIHdpbmRvdy5iZW9uZXZlbnRzW2NvbmZpZy5pZF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBbXG4gICAgaWQsXG4gICAgdHlwZSxcbiAgICB2YXJpYW50LFxuICAgIHBvc2l0aW9uLFxuICAgIGNsYXNzTmFtZSxcbiAgICBpbm5lckhUTUwsXG4gICAgc2VhbFNyYyxcbiAgICBzdHlsZSxcbiAgICBpdGVtUXVlcnksXG4gICAgY29udGFpbmVyUXVlcnksXG4gICAgcGxhY2VtZW50T3BlcmF0aW9uLFxuICAgIGl0ZW1zSWRzLFxuICBdID0gY29uZmlnO1xuXG4gIHRoaXMuY29uZmlnID0gT2JqZWN0LmFzc2lnbihcbiAgICB7XG4gICAgICBpZDogdW5kZWZpbmVkLFxuICAgICAgdHlwZTogXCJmbGFnXCIsXG4gICAgICB2YXJpYW50OiBcInNlYWxcIixcbiAgICAgIHBvc2l0aW9uOiBcIjQ1ZGVnXCIsXG4gICAgICBjbGFzc05hbWU6IHVuZGVmaW5lZCxcbiAgICAgIGlubmVySFRNTDogdW5kZWZpbmVkLFxuICAgICAgc2VhbFNyYzogdW5kZWZpbmVkLFxuICAgICAgc3R5bGU6IHVuZGVmaW5lZCxcbiAgICAgIGl0ZW1RdWVyeTogdW5kZWZpbmVkLFxuICAgICAgY29udGFpbmVyUXVlcnk6IFwic2VsZlwiLFxuICAgICAgcGxhY2VtZW50T3BlcmF0aW9uOiBcImFwcGVuZFwiLFxuICAgICAgaXRlbXNJZHM6IFtdLFxuICAgIH0sXG4gICAge1xuICAgICAgaWQsXG4gICAgICB0eXBlLFxuICAgICAgdmFyaWFudCxcbiAgICAgIHBvc2l0aW9uLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgaW5uZXJIVE1MLFxuICAgICAgc2VhbFNyYyxcbiAgICAgIHN0eWxlLFxuICAgICAgaXRlbVF1ZXJ5LFxuICAgICAgY29udGFpbmVyUXVlcnksXG4gICAgICBwbGFjZW1lbnRPcGVyYXRpb24sXG4gICAgICBpdGVtc0lkcyxcbiAgICB9XG4gICk7XG5cbiAgdGhpcy5pbml0KCk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5NYWdpY0ZsYWdDb21wb25lbnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMucm9vdC5jbGFzc05hbWUgPSB0aGlzLnJvb3QuY2xhc3NOYW1lICsgXCIgaW5pdGlhbGl6ZWRcIjtcblxuICAvLyBhZGQgdGFnc1xuICB0aGlzLmFkZCh0aGlzLmNvbmZpZykudGhlbigocmVzKSA9PiB7XG4gICAgaWYgKHdpbmRvdy5iZW9uZXZlbnRzICYmIHdpbmRvdy5iZW9uZXZlbnRzW3RoaXMuY29uZmlnLmlkXSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHdpbmRvdy5iZW9uZXZlbnRzID0gd2luZG93LmJlb25ldmVudHMgfHwge307XG4gICAgd2luZG93LmJlb25ldmVudHNbdGhpcy5jb25maWcuaWRdID0gdHJ1ZTtcbiAgfSk7XG5cbiAgdmFyIGRlYm91bmNlO1xuXG4gIC8vIHJlYXBseSBvbiBldmVyeSBpbmplY3Rpb24gZnJvbSBub3cgb25cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImJlb24uYnVkZHkuc2xpZGVyLmluaXQuYWZ0ZXJcIiwgKGV2ZW50KSA9PiB7XG4gICAgd2luZG93LmNsZWFyVGltZW91dChkZWJvdW5jZSk7XG4gICAgZGVib3VuY2UgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgZmxhZ3MgYWRkIGFmdGVyIHNsaWRlciBpbml0aWFsaXplYCk7XG4gICAgICB0aGlzLmFkZCh0aGlzLmNvbmZpZywgZG9jdW1lbnQpO1xuICAgIH0sIDUwMCk7XG4gIH0pO1xuXG4gIC8vIHN1cHBvcnQgaGFzaCBjaGFuZ2VzXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiaGFzaGNoYW5nZVwiLCAoZXZlbnQpID0+IHtcbiAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGRlYm91bmNlKTtcbiAgICBkZWJvdW5jZSA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGBmbGFncyBhZGQgYWZ0ZXIgd2luZG93IGNoYW5nZWApO1xuICAgICAgdGhpcy5hZGQodGhpcy5jb25maWcsIGRvY3VtZW50KTtcbiAgICB9LCAxMDAwKTtcbiAgfSk7XG59O1xuXG5NYWdpY0ZsYWdDb21wb25lbnQucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjb250YWluZXIpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKFxuICAgIGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhvcHRpb25zLCBjb250YWluZXIpO1xuICAgICAgbGV0IGNvbnRlbnRUZW1wbGF0ZTtcbiAgICAgIGNvbnRhaW5lciA9IGNvbnRhaW5lciB8fCBkb2N1bWVudDtcblxuICAgICAgaWYgKG9wdGlvbnMudmFyaWFudCA9PT0gXCJidWxsZXRcIikge1xuICAgICAgICBjb250ZW50VGVtcGxhdGUgPSBvcHRpb25zLmlubmVySFRNTDtcbiAgICAgIH1cblxuICAgICAgdmFyIHByb21pc2VzQXJyYXkgPSBbXTtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLml0ZW1zSWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHByb21pc2VzQXJyYXkucHVzaChcbiAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgdmFyIGl0ZW1EZWZpbml0aW9uID0gb3B0aW9ucy5pdGVtc0lkc1tpXTtcbiAgICAgICAgICAgIGxldCBpdGVtSWQsIGFyZ3M7XG5cbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW1EZWZpbml0aW9uKSkge1xuICAgICAgICAgICAgICBbaXRlbUlkLCAuLi5hcmdzXSA9IGl0ZW1EZWZpbml0aW9uO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaXRlbUlkID0gaXRlbURlZmluaXRpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBlbGVtZW50c1NlbGVjdG9yID0gb3B0aW9ucy5pdGVtUXVlcnkucmVwbGFjZSgve2lkfS9naSwgaXRlbUlkKTtcbiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKGVsZW1lbnRzU2VsZWN0b3IpO1xuXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlbGVtZW50c1NlbGVjdG9yLCBlbGVtZW50cyk7XG5cbiAgICAgICAgICAgIGlmICghZWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob3B0aW9ucy50eXBlID09PSBcImR5bmFtaWNcIikge1xuICAgICAgICAgICAgICBjb25zdCBbaXRlbUlubmVySHRtbCwgaXRlbUNsYXNzTmFtZV0gPSBhcmdzO1xuICAgICAgICAgICAgICBpZiAoaXRlbUlubmVySHRtbCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuaW5uZXJIVE1MID0gY29udGVudFRlbXBsYXRlXG4gICAgICAgICAgICAgICAgICA/IGNvbnRlbnRUZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgIFwie3h9XCIsXG4gICAgICAgICAgICAgICAgICAgICAgYCA8c3BhbiBjbGFzcz1cImR5bmFtaWNfaW5mb1wiPiR7aXRlbUlubmVySHRtbH08L3NwYW4+IGBcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgOiBpdGVtSW5uZXJIdG1sO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgb3B0aW9ucy5jbGFzc05hbWUgKz0gaXRlbUNsYXNzTmFtZSB8fCBcIlwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID1cbiAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY29udGFpbmVyUXVlcnkgPT09IFwic2VsZlwiXG4gICAgICAgICAgICAgICAgICAgID8gZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICA6IGVsZW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmNvbnRhaW5lclF1ZXJ5KTtcblxuICAgICAgICAgICAgICAgIGlmICghcGFyZW50KSBwYXJlbnQgPSBlbGVtZW50O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hcHBlbmQocGFyZW50LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBQcm9taXNlLmFsbChwcm9taXNlc0FycmF5KS50aGVuKChyZXMpID0+IHJlc29sdmUocmVzKSk7XG4gICAgfS5iaW5kKHRoaXMpXG4gICk7XG59O1xuXG5NYWdpY0ZsYWdDb21wb25lbnQucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChwYXJlbnQsIG9wdGlvbnMpIHtcbiAgLy8gZG8gbm90IGR1cGxpY2F0ZSB0YWdzXG4gIHZhciBkdXBsaWNhdGUgPSBwYXJlbnQucXVlcnlTZWxlY3RvcihcIi5iZW9uLXRhZ3MuYmVvbi10YWdfX1wiICsgb3B0aW9ucy5pZCk7XG5cbiAgaWYgKGR1cGxpY2F0ZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBidWxsZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gIHZhciBjbGFzc2VzID0gW1xuICAgIFwiYmVvbi10YWdzXCIsXG4gICAgXCJiZW9uLXRhZ19fXCIgKyBvcHRpb25zLmlkLFxuICAgIFwiYmVvbi10YWdfX1wiICsgb3B0aW9ucy5wb3NpdGlvbixcbiAgICBcImJlb24tdGFnX19cIiArIG9wdGlvbnMudHlwZSxcbiAgICBcImJlb24tdGFnX19cIiArIG9wdGlvbnMudHlwZSArIFwiLS1cIiArIG9wdGlvbnMudmFyaWFudCxcbiAgICBvcHRpb25zLmNsYXNzTmFtZSxcbiAgXTtcblxuICB2YXIgc3R5bGUgPSBvcHRpb25zLnN0eWxlO1xuXG4gIGlmIChvcHRpb25zLnNlYWxTcmMpXG4gICAgc3R5bGUgKz0gXCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCIgKyBvcHRpb25zLnNlYWxTcmMgKyBcIik7XCI7XG5cbiAgYnVsbGV0LmNsYXNzTmFtZSA9IGNsYXNzZXMuam9pbihcIiBcIik7XG4gIGJ1bGxldC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBzdHlsZSk7XG4gIGJ1bGxldC5pbm5lckhUTUwgPSBvcHRpb25zLmlubmVySFRNTDtcblxuICBpZiAob3B0aW9ucy5wbGFjZW1lbnRPcGVyYXRpb24gPT09IFwicmVwbGFjZVwiKSB7XG4gICAgcGFyZW50LmlubmVySFRNTCA9IFwiXCI7XG4gIH1cblxuICBwYXJlbnQuYXBwZW5kQ2hpbGQoYnVsbGV0KTtcblxuICAvLyByZWxhdGl2aXplIHBhcmVudCBwb3NpdGlvbiB0byBzdXBwb3J0IGZsb2F0aW5nIHRhZ3NcbiAgLy8gdmFyIHBhcmVudFN0eWxlcyA9IGdldENvbXB1dGVkU3R5bGUocGFyZW50KTtcbiAgLy8gdmFyIHBhcmVudFBvc2l0aW9uID0gcGFyZW50U3R5bGVzLnBvc2l0aW9uO1xuXG4gIC8vIGlmICghcGFyZW50UG9zaXRpb24gfHwgcGFyZW50UG9zaXRpb24gPT09IFwic3RhdGljXCIpIHtcbiAgLy8gICBwYXJlbnQuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XG4gIC8vIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IE1hZ2ljRmxhZ0NvbXBvbmVudDtcbiIsIlwidXNlIHN0cmljdFwiO1xuXG4vLyB2YXIgc2xpZGVyID0gcmVxdWlyZShcIi4vc2xpZGVyXCIpO1xuaW1wb3J0IE1hZ2ljRmxhZ0NvbXBvbmVudCBmcm9tIFwiLi9tYWdpY2ZsYWdcIjtcblxudmFyIE1hZ2ljRmxhZ0luaXRpYWxpemVyID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLmNvbXBvbmVudFJvb3RTZWxlY3RvciA9IFwibWV0YVtuYW1lXj1iZW9uLW1hZ2ljZmxhZ11cIjtcblxuICAvLyBpbml0aWFsaXplIHNsaWRlcnMgYWxyZWFkeSBvbiBwYWdlXG4gIHRoaXMuaW5pdENvbXBvbmVudHMoKTtcblxuICAvLyBiaW5kIGV2ZW50cyB0byBpbml0aWFsaXplIHNsaWRlcnMgcmVhbCB0aW1lXG4gIHRoaXMuYmluZEV2ZW50cygpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgTWFnaWNGbGFnSW5pdGlhbGl6ZXI7XG5cbk1hZ2ljRmxhZ0luaXRpYWxpemVyLnByb3RvdHlwZS5iaW5kRXZlbnRzID0gZnVuY3Rpb24gKCkge1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCB0aGlzLmluaXRDb21wb25lbnRzLmJpbmQodGhpcykpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgIFwiYmVvbi5idWRkeS5lbGVtZW50cy5oYW5kbGUuaXRlbS5pbmplY3Quc3VjY2Vzc1wiLFxuICAgIHRoaXMuaW5pdENvbXBvbmVudEZyb21JbmplY3Rpb24uYmluZCh0aGlzKVxuICApO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgIFwiYmVvbi5idWRkeS5pbmplY3QuYWZ0ZXJcIixcbiAgICB0aGlzLmluaXRDb21wb25lbnRGcm9tSW5qZWN0aW9uLmJpbmQodGhpcylcbiAgKTtcblxuICAvLyBhcHBseSBpbW1lZGlhdGx5XG4gIHRoaXMuaW5pdENvbXBvbmVudHMoKTtcbn07XG5cbk1hZ2ljRmxhZ0luaXRpYWxpemVyLnByb3RvdHlwZS5pbml0Q29tcG9uZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbXBvbmVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgIHRoaXMuY29tcG9uZW50Um9vdFNlbGVjdG9yICsgXCI6bm90KC5pbml0aWFsaXplZClcIlxuICApO1xuXG4gIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGNvbXBvbmVudHMpLmZvckVhY2goXG4gICAgZnVuY3Rpb24gKHJvb3QpIHtcbiAgICAgIHRoaXMuaW5pdENvbXBvbmVudChyb290KTtcbiAgICB9LmJpbmQodGhpcylcbiAgKTtcbn07XG5cbk1hZ2ljRmxhZ0luaXRpYWxpemVyLnByb3RvdHlwZS5pbml0Q29tcG9uZW50RnJvbUluamVjdGlvbiA9IGZ1bmN0aW9uIChldmVudCkge1xuICB2YXIgY29udGFpbmVyID0gZXZlbnQuZGV0YWlsLmNvbnRhaW5lcjtcbiAgdmFyIHJvb3QgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcbiAgICB0aGlzLmNvbXBvbmVudFJvb3RTZWxlY3RvciArIFwiOm5vdCguaW5pdGlhbGl6ZWQpXCJcbiAgKTtcblxuICBpZiAocm9vdCkge1xuICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImxvYWRpbmdcIikge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJET01Db250ZW50TG9hZGVkXCIsXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aGlzLmluaXRDb21wb25lbnQocm9vdCk7XG4gICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbml0Q29tcG9uZW50KHJvb3QpO1xuICAgIH1cbiAgfVxufTtcblxuTWFnaWNGbGFnSW5pdGlhbGl6ZXIucHJvdG90eXBlLmluaXRDb21wb25lbnQgPSBmdW5jdGlvbiAocm9vdCkge1xuICB0cnkge1xuICAgIHdpbmRvdy5iZW9uX2luaXRfbG9nID0gd2luZG93LmJlb25faW5pdF9sb2cgfHwgW107XG5cbiAgICB2YXIgcmF3Q29uZmlnID0gcm9vdC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNvbmZpZ1wiKTtcbiAgICB2YXIgcm9vdElkID0gcm9vdC5wYXJlbnROb2RlLmlkO1xuICAgIHZhciBjb25maWcgPSBKU09OLnBhcnNlKHJhd0NvbmZpZyk7XG5cbiAgICBpZiAod2luZG93LmJlb25faW5pdF9sb2cuaW5kZXhPZihyb290SWQpID4gLTEpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwibWFnaWNmbGFnIGFscmVhZHkgaW5pdGlhbGl6ZWQgXCIgKyByb290SWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHdpbmRvdy5iZW9uX2luaXRfbG9nLnB1c2gocm9vdElkKTtcblxuICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlc29sdmUobmV3IE1hZ2ljRmxhZ0NvbXBvbmVudChyb290LCBjb25maWcpKTtcbiAgICB9KTtcbiAgICAvLyBuZXcgTWFnaWNGbGFnQ29tcG9uZW50KHJvb3QsIGNvbmZpZyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmxvZyhcImZhaWxlZCB0byBidWlsZCBjb21wb25lbnQgXCIgKyB0aGlzLmNvbXBvbmVudFJvb3RTZWxlY3RvciwgZSk7XG4gIH1cbn07XG5cbihmdW5jdGlvbiAoKSB7XG4gIGlmICh3aW5kb3cpIHdpbmRvdy5CZW9uTWFnaWNGbGFnSW5pdGlhbGl6ZXIgPSBNYWdpY0ZsYWdJbml0aWFsaXplcjtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6IiJ9